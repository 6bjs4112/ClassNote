<!DOCTYPE html>
<html lang="kr">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>인터섹션</title>
</head>
<body>
    <article>
        <h2>intersectionObserver</h2>
        <div class="btn">     </div>
    </article>
    <style>
        button{
            width: 150px; margin: 20px 0; display: block;
            transform: translateX(100%); opacity: 0;
            transition: 1s;
        }
        button.on{transform: translateX(0%); opacity: 1;}
        .btn{height: 500px; overflow-y: scroll; border: 1px solid teal;}
        .btn::-webkit-scrollbar{display: none;}/*스크롤바 안보이게*/
    </style>

    <script>
        //div안에 버튼 100개 넣기
        const elBtn = document.querySelector('.btn');
        for(let i=0; i<100; i++){
            let button = document.createElement('button');
            button.append(`테스트 결과물${i+1}`);
            elBtn.append(button);
            // elBtn.innerHTML +=`<button>테스트 결과물${i+1}</button>`; 
        }

        //이제 감시해 봅시다
        const buttons = document.querySelectorAll('.btn button');

        //함수 분리. 
        function contents(entries, observer){
            entries.forEach(function(entry){//대상이 여러개면 무조건 돌려야됨
                
                console.log(entry);//이걸로 봤을때 isintersecting: true로 뜨는 애들이 현재 화면에 나오는 애들임. 
                //그럼 true인 애들만 on 붙게 바꿔봄
                if(entry.isIntersecting==true){
                    //화면 안에 들어오면 on
                    entry.target.classList.add('on');
                    observer.unobserve(entry.target);
                    //이미 감시된 애들은 제거하기. 이게 있으면 else에 들어가있는 remove필요없음
                }//end if
                else{//화면 밖에 있으면 on을 지움
                    entry.target.classList.remove('on');
                }                
            })
        }

        let opt = {
            root:elBtn,//타겟지역. 근데 거의 전지역으로 잡고해서 잡을일 필요없을걸?
            rootMargin:'100px',
            //화면 밖에 100px내에 있으면 on이 들어가있음. 그래서 살짝스크롤하면 애니메이션 안뜨고, 많이 스크롤하면 애니메이션 보임
            threshold:0
            //비율값?
        }
        
        const intersection = new IntersectionObserver(contents,opt);


        
        intersection.observe(buttons[0]);
        intersection.observe(buttons[1]);
        //뜯어보면 target이 있고, 지정해서 일을 시킬 수 있음

        //모든 버튼에 다 on 넣을 수 있게 감시 대상에 넣기
        buttons.forEach(function(btn){
            intersection.observe(btn)
        })
        


    </script>
</body>
</html>